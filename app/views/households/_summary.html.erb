<% @head = current_user.household.user %>
<% @current_user = current_user %>

<%# Page title: %>
<h1> <%= current_user.household.name %> </h1>

<%# Head: %>
<h2> Head: </h2>
<div class="panel panel-default">
  <div class="panel-body">
    <%= gravatar_for @head, size: 35 %>
    <%= @head.firstname + " " + @head.surname %>
  </div>
  <div class="panel-footer">
    <button type="button" class="btn">Do nothing!</button>
  </div>
</div>
</br>

<%# Members: %>
<% if @head.household.users.count > 1 %>
  <h2> Members: </h2>
  <% User.where(household_id: @current_user.household.id).find_each do |member| %>
    <% if member.id != @head.id %>
      <div class="panel panel-default">
        <div class="panel-body">
          <%= gravatar_for member, size: 35 %>
          <%= member.firstname + " " + member.surname %>
        </div>
        <%# If the user viewing the page is the head of the household: %>
        <% if @current_user.id == @head.id %>
        <div class="panel-footer">
          <%= link_to "Kick Member", kick_member_path(member.id), method: :post, data: {confirm: "Are you sure?"} %>
        </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>
</br>

<%# Shopping Lists: %>
<h2> Shopping lists: </h2>
<p> To be implemented. <p>

<%# Head Admin stuff: %>
<% if @current_user.id == @head.id %>
  <h2> Household Head administrative functions </h2>
  <div class="panel-group">

    <h3> Can other users apply to become members? </h3>
    <div class="panel panel-default">
      <div class="panel-body">
      <% if @head.household.joinable? %>
        <%= link_to "Close Household", close_household_path, class: "btn btn-primary" %>
      <% else %>
        <%= link_to "Open Housheold", open_household_path, class: "btn btn-primary" %>
      <% end %>
      </div>
    </div>

    <% unless @current_user.household.invitations.empty? %>
      <h3> Pending Membership Applications: </h3>
      <% Invitation.where("household_id = ? AND is_invitation = ?", @head.household.id, false).each do |application| %>
      <div class="panel panel-default">
        <div class="panel-body">
          <%= gravatar_for application.user, size: 35 %>
          <%= application.user.firstname + " " + application.user.surname %>
        </div>
        <div class="panel-footer">
          <%= link_to "Decline Application", decline_application_path(application.user.id, application.household.id), method: :post, data: {confirm: "Are you sure you want to decline this user?"} %>
          <%= link_to "Accept Application", accept_application_path(application.user.id, application.household.id), method: :post, data: {confirm: "Are you sure you want to accept this user?"} %>
        </div>
      </div>
      <% end %>
    <% end %>

    <% unless @current_user.household.invitations.empty? %>
      <h3> Pending Membership Invitations: </h3>
      <% Invitation.where("household_id = ? AND is_invitation = ?", params[:household_id], true).each do |invitation| %>
      <div class="panel panel-default">
        <div class="panel-body">
          <%= gravatar_for invitation.user, size: 35 %>
          <%= invitation.user.firstname + " " + invitation.user.surname %>
        </div>
        <div class="panel-footer">
          <%= link_to "Rescind Invitation", rescind_invitation_path(application.user.id, application.household.id), method: :post, data: {confirm: "Are you sure you want to rescind this invitation?"} %>
        </div>
      </div>
      <% end %>
    <% end %>

  </div>
<% end %>
